---
title: "session_4_pdf"
author: "Julian Maitra"
format: pdf
editor: visual
---

## 

# Session 4

La session 4 a pour but d'introduire trois √©l√©ments fondamentaux en
analyse de donn√©es avec R :

1.  Installer et charger des **paquets R** sur son ordinateur
2.  Utiliser des **jeux de donn√©es int√©gr√©s en R** pour s'entra√Æner en
    analyse de donn√©es
3.  Apprendre √† utiliser le paquet **ggplot2** pour cr√©er des
    visualisations de donn√©es

## Les paquets R

::: {.callout-note icon="true"}
## √Ä noter

Dans la programmation R, un **paquet** (angl. *package*) est un ensemble
de fonctions, de donn√©es et de code compil√© dans un format bien d√©fini.

Les paquets √©tendent les fonctionnalit√©s de R de base en fournissant des
outils suppl√©mentaires pour l'analyse des donn√©es, la visualisation,
l'apprentissage automatique, la mod√©lisation statistique et beaucoup
d'autres applications sp√©cialis√©es.

Les paquets R peuvent √™tre d√©velopp√©s par n'importe qui et partag√©s
gratuitement avec d'autres (open source). Par cons√©quent, une grande
multitude de paquets R sont disponibles.
:::

Notez que la plupart des paquets R doit √™tre install√© s√©par√©ment,
normalement depuis le site [Comprehensive R Archive Network
(CRAN)](http://cran.r-project.org). Dans ce cours, nous nous
concentrerons sur deux paquets c√©l√®bres :

-   `ggplot2` pour cr√©er des **visualisations de donn√©es**

-   `dplyr` pour **manipuler les jeux de donn√©es**

Tous deux font partie du [tidyverse](https://www.tidyverse.org), une
collection de paquets con√ßus pour la science des donn√©es. Nous
utiliserons √©galement le paquet suivant :

-   `ggthemes` pour **augmenter le design des graphiques**

Pour utiliser un paquet R sur votre ordinateur, il faut :

1.  D'abord **installer** le paquet en question avec la fonction
    `install.packages()`. Cela peut durer quelques minutes.
2.  Ensuite **activer** le paquet avec la fonction `library()`.

::: {.callout-tip title="Astuce"}
Dans RStudio, on peut aussi installer les paquets via l'onglet **Tools**
et le menu d√©roulant : Cliquez sur *Install Packages*... et cherchez les
paquets que vous voulez installer.
:::

Utilisez le code suivant pour installer les paquets R requis pour notre
cours. Enlevez les croisillons, √©x√©cutez le code avec
`install.packages()` puis r√©ajouter les croisillons pour √©viter de
r√©installer les paquets chaque fois que vous √©x√©cutez le code dans votre
script ! Activer ensuite les paquets avec `library()`.

```{r}
#| echo: true
#| output: false
# install.packages("tidyverse")
# install.packages("ggthemes")

library(tidyverse)
library(ggthemes)
```

√Ä noter : `ggplot2` et `dplyr` sont install√©s avec le `tidyverse`, il ne
faut donc plus les installer s√©par√©ment.

::: {.callout-caution collapse="false"}
## Attention

Notez qu'une fois install√©, vous n'avez pas besoin de le r√©installer les
paquets √† chaque fois avec `install.packages()`. Cependant, vous devez
**activer** tous les paquets R que vous voulez utiliser dans une session
avec la commande `library()`. Sans activation, vous allez recevoir des
messages d'erreur.
:::

Certains paquets ont des documentations auxquelles vous pouvez acc√©der
gr√¢ce au point d'interrogation. Ces infos sont affich√©s dans le volet
*Output* sous l'onglet *Help*.

-   `?ggplot2`

-   `?dplyr`

En ligne, vous pouvez √©galement trouver de nombreuses ressources qui
expliquent en d√©tail les fonctionnalit√©s des diff√©rents paquets R et
vous renvoient vers d'autres livres, tutoriels, cours, etc., p. ex. :

-   [Documentation officielle de
    `ggplot2`](https://ggplot2.tidyverse.org/index.html)

-   [Documentation officielle de `dplyr`](https://dplyr.tidyverse.org)

-   [Exemples de graphiques cr√©es avec les diff√©rents designs de
    `ggthemes`](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/)

Vous pouvez v√©rifier quels paquets sont **actuellement install√©s sur
votre ordinateur** avec la fonction `installed.packages()` (vous pouvez
laisser vide l'espace entre parenth√®ses) :

```{r}
#| echo: true
#| output: false
installed.packages()
```

## Les jeux de donn√©es int√©gr√©s

Une excellente fa√ßon, et probablement la plus efficace, d'apprendre √†
utiliser R pour l'analyse de donn√©es consiste √† travailler avec des
**jeux de donn√©es int√©gr√©s dans R**.

Ces jeux de donn√©es exemplaires pr√©sentent deux avantages principaux.

1.  Il est facile d'y acc√©der et de les charger dans votre session
    RStudio, car ils sont int√©gr√©s √† R et √† certains de ses paquets.

Cela les distingue fortement des donn√©es du "monde r√©el", comme les
donn√©es de questionnaires ou de m√©dias sociaux, qu'il faut souvent
d'abord nettoyer et formater, puis importer dans RStudio sous forme de
fichiers externes. Avec les jeux de donn√©es int√©gr√©s, vous pouvez
imm√©diatement commencer l'analyse et la visualisation des donn√©es.

2.  Ces jeux de donn√©es ont prouv√© leur utilit√© dans d'innombrables
    supports d'apprentissage.

Par cons√©quent, vous pouvez facilement trouver des ressources
suppl√©mentaires et des exemples de code √† leur sujet.

Dans ce qui suit, nous allons explorer quatre jeux de donn√©es classiques
de ce type :

-   `iris`

-   `mtcars`

-   `diamonds`

-   `palmerpenguins`

::: {.callout-tip title="Astuce"}
Vous pouvez afficher les jeux de donn√©es qui sont actuellement
acc√©ssible sur votre ordinateur avec la commande `data().`
:::

### le jeu de donn√©es `iris`

Le jeu de donn√©es `iris` est un ensemble de donn√©es c√©l√®bre qui contient
les mesures en centim√®tres des variables longueur et largeur du s√©pale,
ainsi que longueur et largeur du p√©tale, pour trois exp√®ces de fleurs
d'iris (Setosa, Virginica et Versicolor). Il y a 150 observations en
total (50 pour chaque esp√®ce).

Le jeu de donn√©es a √©t√© rendu c√©l√®bre par le statisticien et biologiste
britannique **Ronald Fisher** dans un article scientifique de 1936 qui
avait beaucoup d'influence dans le domaine des statistiques. Les donn√©es
d'iris eux-m√™me ont √©t√© r√©colt√© par le botaniste Edgar Anderson en 1935
sur la p√©ninsule de Gasp√©sie au Qu√©b√©c, Canada.

::: {.callout-caution collapse="true"}
## Plus sur Ronald Fisher

Ronald Fisher (1890-1962) √©tait un statisticien, g√©n√©ticien et
biologiste britannique qui a jou√© un r√¥le crucial dans le d√©veloppement
de la science statistique moderne. Il est connu pour son travail dans le
d√©veloppement des fondements des m√©thodes statistiques, incluant
l'analyse de variance (ANOVA), le test exact de Fisher et l'estimation
du maximum likelihood. Fisher a √©galement apport√© des contributions
significatives en g√©n√©tique, o√π son travail sur la th√©orie de la
s√©lection naturelle et la g√©n√©tique des populations a aid√© √† combler le
foss√© entre la g√©n√©tique mend√©lienne et l'√©volution darwinienne. Il est
consid√©r√© comme l'un des architectes principaux de la synth√®se
n√©o-darwinienne. Son influence s'√©tend au-del√† de la statistique et de
la g√©n√©tique aux domaines plus larges de la biologie et de la recherche
agricole, faisant de lui une figure pivotale de la science du 20e
si√®cle.
:::

<a title="Diego Mariano, CC BY-SA 4.0 &lt;https://creativecommons.org/licenses/by-sa/4.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Flores_de_%C3%8Dris.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Flores_de_%C3%8Dris.png/512px-Flores_de_%C3%8Dris.png" alt="Flores de √çris" width="512"/></a>

Dans l'apprentissage de R, ce jeu de donn√©es est souvent utilis√© pour
illustrer diverses techniques d'analyse de donn√©es, y compris le
clustering, la classification et la visualisation.

Explorons un peu le jeu de donn√©es `iris` avec du code !

```{r}
#| echo: true
#| output: false

dim(iris) # Ceci affiche le nombre de lignes et de colonnes)

head(iris) # Affiche les six premi√®res lignes

str(iris) # Informations sur la structure du jeu de donn√©es

names(iris) # Affiche les noms des colonnes
```

Regardons ce que √ßa donne apr√®s l'√©x√©cution de chaque ligne de code :

```{r}
#| echo: true
#| output: true

dim(iris) 

head(iris) 

str(iris) 

names(iris) 
```

::: {.callout-tip title="Astuce"}
Vous pouvez consulter la documentation pour beaucoup de jeux de donn√©es
avec un point d'interrogation : `?iris()`.
:::

### le jeu de donn√©es `mtcars`

Utilisez le script suivant pour analyser `mtcars`(lisez √©galement la
documentation avec `?mtcars`) !

```{r}
#| warning: false
#| echo: true
#| output: false

# Chargez le jeu de donn√©es mtcars. Il devrait appara√Ætre dans l'environnement
data(mtcars)

# Affichez mtcars
mtcars

# vous pouvez explorer mtcars manuellement en double cliquant dessus dans l'environnement

# Affichez seulement les six premi√®res observations
head(mtcars)

# Affichez seulement les six derni√®res observations
tail(mtcars)

# Appliquez quelques autres commandes pour explorer ce jeu de donn√©es
class(mtcars)
dim(mtcars)

str(mtcars)
summary(mtcars)

glimpse(mtcars) # cette commande marche seulement si vous avez activ√© le tidyverse

# Extraire la colonne mpg ("miles per gallon") avec le signe $
# et calculer la moyenne, la m√©dianne, le minimum et le maximum

mtcars$mpg

mean(mtcars$mpg)

median(mtcars$mpg)

min(mtcars$mpg)

max(mtcars$mpg)
```

<a title="Jeremy from Sydney, Australia, CC BY 2.0 &lt;https://creativecommons.org/licenses/by/2.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:1974_Toyota_Corolla_(KE20)_L_2-door_sedan_(20538771443).jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/1974_Toyota_Corolla_%28KE20%29_L_2-door_sedan_%2820538771443%29.jpg/512px-1974_Toyota_Corolla_%28KE20%29_L_2-door_sedan_%2820538771443%29.jpg" alt="1974 Toyota Corolla (KE20) L 2-door sedan (20538771443)" width="512"/></a>

Un des mod√®les de mtcars : Le Toyota Corolla de 1974. [Source :
wikimedia.org](https://commons.wikimedia.org/wiki/File:1974_Toyota_Corolla_(KE20)_L_2-door_sedan_(20538771443).jpg)

### le jeu de donn√©es `diamonds`

C'est maintenant √† vous d'explorer ce jeu de donn√©es avec du code !

Utilisez √©galement `?diamonds()` !

<a title="Jerry Cone, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Diamond-1128734.jpg"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Diamond-1128734.jpg/512px-Diamond-1128734.jpg" alt="Diamond-1128734" width="512"/></a>

Qu'est-ce qui d√©finit le prix d'un diamant ? [Source :
wikimedia.org](https://commons.wikimedia.org/wiki/File:Diamond-1128734.jpg)

## Introduction aux visualisations avec `ggplot2`

::: {.callout-note icon="true"}
## √Ä noter

`ggplot2`, qui fait partie du `tidyverse`, est un paquet de
visualisation de donn√©es tr√®s populaire dans R. Il a √©t√© con√ßu pour
faciliter la cr√©ation de graphiques complexes et multicouches avec une
syntaxe coh√©rente et consistante nomm√©e *grammar of graphics*.

*ggplot2* est donc un acronyme form√© √† partir des mots *grammar of
graphics plots* (fran√ßais : *grammaire des graphiques*). Le "2" dans
ggplot2 indique simplement la deuxi√®me g√©n√©ration de ce paquet R.

Avec `ggplot2`, les utilisateurs peuvent construire des graphiques de
mani√®re incr√©mentale en ajoutant des couches, ce qui le rend flexible
pour une large gamme de besoins graphiques. Cela permet de cr√©er des
visualisations hautement personnalisables et esth√©tiquement attrayantes,
allant de simples diagrammes de dispersion √† des figures multi-panneaux
complexes.
:::

Le tableau suivant d√©crit les couches d'un graphique ggplot :

| Couche                                                             | D√©scription/Variables                                                                         | Obligatoire ? |
|-----------------------|:--------------------|:--------------------------:|
| *data*                                                             | le jeu de donn√©es que nous voulons visualiser                                                 |      oui      |
| *aesthetics*                                                       | le *mapping* de nos variables : axes *x* et *y*, *color*, *fill*, *alpha*, *line width*, etc. |      oui      |
| *geometries*                                                       | le type visuel du graphique : *point*, *line*, *histogram*, *bar*, *boxplot*                  |      oui      |
| *themes*                                                           | Le design du graphique                                                                        |      non      |
| Autres couches optionelles : *facets*, *statistics*, *coordinates* | Pour des visualisations plus complexes                                                        |      non      |

: Les couches d'un graphique ggplot

Pour comprendre comment cela fonctionne, voici un exemple de code dans
lequel les diff√©rentes couches d'un graphique *ggplot* sont ajout√©es
√©tape par √©tape dans la fonction `ggplot()`. (Normalement, nous ne
proc√©derions pas ainsi, mais utiliserions directement le code en entier
pour cr√©er le graphique).

Le but dans cet exemple est de visualiser le jeu de donn√©es `diamonds`
pour comprendre la relation entre les variables `price` (prix) et
`carat` (poids) des diamants dans le jeu de donn√©es !

::: {.callout-note icon="true"}
## √Ä noter

Important : avant d'analyser un ensemble de donn√©es, il faut toujours
acqu√©rir des **connaissances contextuelles** sur ce que les donn√©es
repr√©sentent.

Dans notre exemple, il s'agit de diamants. Dans le monde des diamants,
il est important de comprendre qu'il existe **quatre crit√®res de
qualit√©** qui d√©terminent **la valeur** (donc le prix) d'un diamant. Ce
sont les suivants :

-   La taille (angl. *cut*)

-   La puret√© (*clarity*)

-   La couleur (*color*)

-   Le poids en carats (*carat*)

En anglais, on parle donc aussi des 4C. Le jeu de donn√©es `diamonds`
contient pr√©cis√©ment ces variables.
:::

```{r}
# La premi√®re couche, data, d√©finit le jeu de donn√©es
ggplot(data = diamonds)
```

Notre graphique n'est pour l'instant qu'une zone grise ! Catastrophe ?
Bien s√ªr que non üòÄ. Nous devons maintenant d√©finir les autres
param√®tres de la fonction `ggplot()` !

```{r}
# La deuxi√®me couche, aesthetics, d√©finit le mapping de nos variables sur les axes y et x
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price))
```

La zone grise a maintenant re√ßu des unit√©s pour ses axes x (`carat`) et
y (`price`). Mais il n'y a toujours pas de donn√©es affich√©es !

```{r}
# La troisi√®me couche, geometries, d√©finit le type visuel de notre graphique
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_point()
```

Ouf, si vous avez ex√©cut√© le dernier code, vous avez maintenant 53 940
points de donn√©es affich√©es dans votre graphique ! Car il y a tant
d'observations dans le jeu de donn√©es `diamonds`.

Bon courage si vous avez un vieil ordinateur, cela peut prendre un
certain temps avant que R ne produise le graphique...

Mais jetons un coup d'≈ìil au graphique. Qu'est-ce qui saute aux yeux,
pouvez-vous d√©j√† identifier des tendances ?

```{r}
# On peut maintenant encore optimiser notre graphique
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price, color = clarity)) +
  geom_point()
```

Vous avez remarqu√© ce qui a chang√© dans le code ?

```{r}
# Ajoutons encore une couche optionnelle mais utile au graphique : labs() nous permet d'ajouter et de personnaliser des titres, sout-titres, titre d'axes, titres de l√©gendes, etc. ! 
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price, color = clarity)) +
  geom_point() + 
  ggtitle("")  + 
  labs(title = "La relation entre prix et carat des diamants",
    subtitle = "n = 53 940 observations",
    y = "Prix", 
    x = "Carat", 
    colour = "Puret√©")
```

Maintenant il s'agit d'interpr√©ter le graphique. Que nous dit-il sur la
relation entre prix et carats des diamants ? Quel r√¥le joue la variable
*puret√©* (`clarity`)?

## Devoir pour Session 5

-   Ex√©cutez toutes les sections de code de la session 4 sur votre
    ordinateur.

-   Entra√Ænez-vous √† ouvrir un nouveau script R, √† d√©finir un r√©pertoire
    de travail et √† enregistrer le script dans un dossier sur votre
    ordinateur.

-   Assurez-vous que le paquet R `tidyverse` est install√© correctement
    sur votre ordinateur.

-   Utilisez le code R de mani√®re autonome pour explorer le jeu de
    donn√©es `diamonds`. Vous devez √™tre en mesure de comprendre et
    d'expliquer comment il est structur√© (nombre d'observations n, unit√©
    statistique, variables, origine des donn√©es, etc).
